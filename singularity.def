Bootstrap: docker
From: ubuntu:20.04

%setup
    # Commands to run at setup stage
    touch ${SINGULARITY_ROOTFS}/file1

%files
    . /opt/build_files

%post
    export DEBIAN_FRONTEND=noninteractive
    # Commands to run at build time
    apt-get update && apt-get install -y cmake git mpich build-essential openmpi-bin openmpi-common libopenmpi-dev

%test
    # Commands to run when the container is executed
    echo "cloning..."
    git clone --recurse-submodules https://github.com/BiceMar/sweng_project_part2.git
    #it submodule init
    #git submodule update
    echo "running tests..."
    cd sweng_project_part2
    ./build.sh
    cd build
    mpirun -np 4 ctest --test-dir build
    echo "tests finished..."

%labels
    # Metadata labels
    SWENG4HPC project v.1.0

