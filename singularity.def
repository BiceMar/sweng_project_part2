Bootstrap: docker
From: ubuntu:20.04

%setup
    # Commands to run at setup stage
    touch ${SINGULARITY_ROOTFS}/file1

%files
    . /opt/build_files

%post
    export DEBIAN_FRONTEND=noninteractive
    # Commands to run at build time
    apt-get update && apt-get install -y cmake git mpich build-essential openmpi-bin openmpi-common libopenmpi-dev
    #mkdir -p /opt/my_project/data
    echo "cloning the repo..."
    git clone --recurse-submodules https://github.com/BiceMar/sweng_project_part2.git
    #chmod +x /sweng_project_part2/build.sh
    #cd /opt/build_files
    #rm -rf build
    cd sweng_project_part2
    git submodule init
    git submodule update
    ./build.sh
    #cd /sweng_project_part2
    #cd build
    #ctest --test-dir build

%test
    # Commands to run when the container is executed
    echo "Test run scripts"

%runscript
    # Commands to test the container functionality
    echo "running tests..."
    cd sweng_project_part2
    ./build.sh
    cd build
    ctest --test-dir build

%labels
    # Metadata labels
    SWENG4HPC project v.1.0

